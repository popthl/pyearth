# pyearth.py 项目说明
## 项目简介
pyearth.py 是一个基于 PyVista 和 PyQt5 的 3D 天文可视化应用，用于模拟地球自转、显示日月行星位置以及星座分布。该应用提供了直观的用户界面，允许用户控制仿真时间、观察地球自转和太阳系天体运动。
项目使用trea开发。

## 功能特性
- 3D 地球模型 ：带有纹理贴图的地球模型，支持地球自转仿真
- 星空背景 ：带有星空纹理的天球，显示恒星分布
- 星座可视化 ：显示星座连线和名称
- 日月行星位置 ：使用 Skyfield 库和 de421.bsp 文件计算并显示太阳系天体位置
- 时间控制 ：可调整仿真时间步长，从 1 秒到 24 小时
- 相机控制 ：支持鼠标拖动和滚轮缩放，可选相机随地球自转或保持固定
- 地形交互模式 ：保持 view_up 方向固定，提供更直观的三维交互体验
## 安装要求
- Python 3.12 (最新的3.14不支持)
- PyVista
- PyQt5
- NumPy
- Skyfield
- jplephem (Skyfield 依赖)
- de421.bsp 文件 (JPL 星历数据)
- 纹理文件：
  - textures/starmap_4k_flipped.jpg (星空纹理)
  - textures/constellation_figures_flipped.jpg (星座连线纹理)
- HeavensAbove 恒星数据 (stars.txt)
## 使用方法
1. 安装依赖 ：
   
   ```
   pip install pyvista pyqt5 numpy 
   skyfield
   ```
2. 下载 de421.bsp 文件 ：
   从 JPL 网站 下载 de421.bsp 文件，放置在项目根目录。
3. 准备纹理文件 ：
   将所需的纹理文件放置在 textures 目录中。
4. 运行应用 ：
   
   ```
   python pyearth.py
   ```
## 控件说明
### 控制面板
- 仿真时间 ：显示当前仿真时间，格式为 UTC
- 显示恒星 ：控制是否显示恒星和星座
- 显示天球网格 ：控制是否显示天球网格线
- 显示星座连线图 ：控制是否显示星座连线纹理
- 显示日月和行星 ：控制是否显示太阳系天体
- 地球自转 ：控制地球自转时相机是否保持固定
- 运行仿真 ：开始仿真时间流动
- 暂停仿真 ：暂停仿真时间流动
- 仿真步长 ：通过滑块调整仿真时间步长，从 -24h 到 24h
### 交互控制
- 鼠标左键 ：旋转视角
- 鼠标中键 ：平移视角
- 鼠标右键/滚轮 ：缩放视角
- 地形交互模式 ：保持 view_up 方向固定，提供更直观的三维交互体验
## 技术实现细节
### 地球自转仿真
- 使用 Skyfield 库计算格林威治恒星时 (GMST)
- 根据 GMST 的差值计算地球自转角度
- 从当前状态开始应用旋转，确保平滑的自转效果
### 太阳系天体位置计算
- 使用 Skyfield 库和 de421.bsp 文件计算天体位置
- 转换赤经赤纬坐标为 3D 空间坐标
- 添加太阳到地心的连线和光源
### 相机控制
- 支持相机随地球一起自转或保持固定
- 地形交互模式保持 view_up 方向不变
- 鼠标拖动和滚轮缩放后保存相机位置
### 时间控制
- 支持多种时间步长，从 1 秒到 24 小时
- 可向前或向后调整仿真时间
- 实时更新时间显示和天体位置
## 注意事项
- 性能优化 ：由于需要实时计算天体位置和地球自转，对于低配置设备可能会有性能压力
- 纹理文件 ：确保纹理文件路径正确，否则可能导致纹理加载失败
- de421.bsp 文件 ：必须下载并放置在正确位置，否则无法计算天体位置
- 坐标系 ：使用右手坐标系，Z 轴指向北极，X 轴指向春分点
## 扩展建议
- 添加更多天体，如小行星和彗星
- 实现更多相机预设位置，如从不同行星视角观察
- 添加轨道显示功能，显示行星的运行轨道
- 实现星空随时间变化的效果，如恒星的周日运动
- 添加更多交互控件，如视角预设和时间快速调整
## 故障排除
- 纹理加载失败 ：检查纹理文件路径和格式是否正确
- 天体位置计算错误 ：检查 de421.bsp 文件是否存在且完整
- 性能问题 ：尝试减小时间步长或关闭一些视觉效果
- 相机控制异常 ：尝试重置相机位置或切换地形交互模式
通过这个应用，您可以直观地了解地球自转、太阳系天体运动以及星座分布，为天文学习和科普教育提供了一个生动的可视化工具。
